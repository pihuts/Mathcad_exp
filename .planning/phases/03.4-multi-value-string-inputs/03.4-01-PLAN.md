---
phase: 03.4-multi-value-string-inputs
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/InputModal.tsx
  - frontend/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter multiple string values via a List tab (one per line in textarea)"
    - "Duplicate string values are silently removed before saving"
    - "Empty lines and whitespace-only lines are ignored"
    - "Iteration count tooltip shows breakdown per input (e.g., 3 materials x 5 lengths = 15)"
    - "Single-value string input still works (no regression)"
    - "CSV string deduplication applies to string CSV columns"
  artifacts:
    - path: "frontend/src/components/InputModal.tsx"
      provides: "List tab with Textarea for multi-value string entry, deduplication logic"
      contains: "Tabs.Tab value=\"list\""
    - path: "frontend/src/App.tsx"
      provides: "Iteration count breakdown tooltip, aliasTypes restoration from library load"
      contains: "iterationBreakdown"
  key_links:
    - from: "frontend/src/components/InputModal.tsx"
      to: "frontend/src/App.tsx"
      via: "onSave callback passing deduplicated string array"
      pattern: "new Set"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/utils/generators.ts"
      via: "generateCartesian receives string arrays"
      pattern: "generateCartesian"
---

<objective>
Add multi-value string input support via a List tab in InputModal with textarea entry, silent deduplication, and an iteration count breakdown tooltip in the batch preview.

Purpose: Engineers can enter multiple string values (material names, labels, etc.) for batch operations without creating CSV files, bringing string inputs to feature parity with numeric Range/List functionality.

Output: Updated InputModal.tsx with List tab and deduplication; updated App.tsx with iteration breakdown tooltip and library type restoration.
</objective>

<execution_context>
@C:\Users\peter\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\peter\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.4-multi-value-string-inputs/03.4-CONTEXT.md
@.planning/phases/03.4-multi-value-string-inputs/03.4-RESEARCH.md
@.planning/phases/03.3-string-inputs/03.3-01-SUMMARY.md
@frontend/src/components/InputModal.tsx
@frontend/src/App.tsx
@frontend/src/utils/generators.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add List tab to InputModal with textarea and deduplication</name>
  <files>frontend/src/components/InputModal.tsx</files>
  <action>
Modify InputModal.tsx to add multi-value string entry:

1. **Add Textarea import** - Add `Textarea` to the Mantine imports at the top of the file.

2. **Add list state** - Add a new state variable:
   ```typescript
   const [listValues, setListValues] = useState<string>('')
   ```

3. **Add List tab to tab list** - After the existing `{inputType === 'string' && <Tabs.Tab value="single">Single Value</Tabs.Tab>}`, add:
   ```typescript
   {inputType === 'string' && <Tabs.Tab value="list">List</Tabs.Tab>}
   ```

4. **Add List tab panel** - After the existing Single Value tab panel (after the closing `)}` of the `{inputType === 'string' && (` block for Single Value), add a new tab panel:
   ```typescript
   {inputType === 'string' && (
     <Tabs.Panel value="list" pt="md">
       <Stack>
         <Textarea
           label="String Values (one per line)"
           placeholder={"Material A\nMaterial B\nMaterial C"}
           value={listValues}
           onChange={(e) => setListValues(e.currentTarget.value)}
           autosize
           minRows={3}
           maxRows={10}
           description="Enter one value per line. Empty lines and duplicates are removed automatically."
         />
         {listValues.trim().length > 0 && (
           <Text size="xs" c="dimmed">
             {[...new Set(listValues.split(/\r?\n/).map(v => v.trim()).filter(v => v.length > 0))].length} unique value(s)
           </Text>
         )}
       </Stack>
     </Tabs.Panel>
   )}
   ```

5. **Update handleSave for List tab** - In the `else if (inputType === 'string')` branch of handleSave, add a new case for `activeTab === 'list'` between the 'single' and 'csv' cases:
   ```typescript
   } else if (activeTab === 'list') {
     const rawValues = listValues
       .split(/\r?\n/)
       .map(v => v.trim())
       .filter(v => v.length > 0);
     value = [...new Set(rawValues)];
     if (value.length === 0) return;
   ```

6. **Add CSV string deduplication** - In the existing string CSV branch (`activeTab === 'csv'`), wrap the value assignment with Set deduplication:
   Change:
   ```typescript
   value = csvData.map(row => String(row[selectedHeader]).trim());
   if (value.some((v: string) => v === '')) return;
   ```
   To:
   ```typescript
   const rawCsvValues = csvData
     .map(row => String(row[selectedHeader]).trim())
     .filter(v => v.length > 0);
   value = [...new Set(rawCsvValues)];
   if (value.length === 0) return;
   ```

7. **Update default tab** - In the useEffect that resets activeTab on inputType change, change the string default from `'single'` to `'list'` since multi-value entry is the primary use case for this phase:
   ```typescript
   if (inputType === 'string') {
     setActiveTab('list');
   ```

**Important:** Use `split(/\r?\n/)` (regex) instead of `split('\n')` to handle both Windows (CRLF) and Unix (LF) line endings. The `trim()` call also handles any stray `\r` characters.

**Do NOT** change any numeric input handling. The Range tab and numeric CSV handling must remain completely unchanged.
  </action>
  <verify>
Run `cd frontend && npx tsc --noEmit` to verify TypeScript compilation passes with zero errors. Open the dev server (`npm run dev`) and visually confirm the InputModal shows three tabs when String type is selected: Single Value, List, CSV.
  </verify>
  <done>
InputModal shows List tab for string type with autosize Textarea. Entering multiple lines produces a deduplicated array. CSV string columns are also deduplicated. Default tab for string type is List. TypeScript compiles cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add iteration count breakdown tooltip and library type restoration</name>
  <files>frontend/src/App.tsx</files>
  <action>
Modify App.tsx to add an iteration breakdown tooltip and fix library loading for multi-value strings:

1. **Add Tooltip import** - Add `Tooltip` to the Mantine imports at the top of App.tsx.

2. **Add iteration breakdown memo** - After the existing `iterationCount` useMemo, add a new useMemo for the breakdown:
   ```typescript
   const iterationBreakdown = useMemo(() => {
     const keys = Object.keys(aliasConfigs);
     if (keys.length === 0) return null;

     const parts = keys.map(key => {
       const count = aliasConfigs[key].length;
       const type = aliasTypes[key] || 'number';
       return `${key} (${type}): ${count} value${count !== 1 ? 's' : ''}`;
     });

     const formula = keys.map(key => aliasConfigs[key].length).join(' \u00d7 ');
     const total = keys.reduce((acc, key) => acc * aliasConfigs[key].length, 1);

     return `${parts.join('\n')}\n\n${formula} = ${total} iterations`;
   }, [aliasConfigs, aliasTypes]);
   ```

3. **Replace iteration count display** - Find the existing `Total Iterations: {iterationCount}` Text element (around line 354). Replace it with:
   ```typescript
   {iterationBreakdown ? (
     <Tooltip label={iterationBreakdown} multiline withArrow position="bottom">
       <Text size="sm" fw={500} style={{ cursor: 'help', borderBottom: '1px dotted #868e96' }}>
         Total Iterations: {iterationCount}
       </Text>
     </Tooltip>
   ) : (
     <Text size="sm" fw={500}>
       Total Iterations: {iterationCount}
     </Text>
   )}
   ```

4. **Restore aliasTypes on library load** - In the `handleLoadLibraryConfig` function, add type detection when loading configs. After the `config.inputs.forEach` loop, add:
   ```typescript
   const newAliasTypes: Record<string, 'number' | 'string'> = {};
   config.inputs.forEach((inputConfig) => {
     const values = Array.isArray(inputConfig.value) ? inputConfig.value : [inputConfig.value];
     const isString = values.length > 0 && typeof values[0] === 'string';
     newAliasTypes[inputConfig.alias] = isString ? 'string' : 'number';
   });
   ```
   Then add `setAliasTypes(newAliasTypes);` after the existing `setAliasUnits(newAliasUnits);` call.

**Do NOT** change workflow handling, batch run logic, or any other existing functionality.
  </action>
  <verify>
Run `cd frontend && npx tsc --noEmit` to verify TypeScript compilation passes with zero errors. Visually confirm the iteration count shows a dotted underline and hovering displays the breakdown tooltip with per-input value counts and the multiplication formula.
  </verify>
  <done>
Iteration count displays with hover tooltip showing breakdown (e.g., "Material (string): 3 values\nLength (number): 5 values\n\n3 x 5 = 15 iterations"). Library loading correctly restores aliasTypes for string inputs. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd frontend && npx tsc --noEmit` passes with zero errors.
2. InputModal string tabs: Selecting String type shows Single Value, List, and CSV tabs.
3. List tab entry: Typing multiple lines in textarea shows unique value count preview.
4. Deduplication: Entering "A\nB\nA\nC" shows "3 unique value(s)" (not 4).
5. Empty line handling: Entering "A\n\n\nB" shows "2 unique value(s)".
6. Save produces array: Saving List tab with "A\nB\nC" results in aliasConfigs entry with ["A", "B", "C"].
7. Iteration tooltip: Hovering over "Total Iterations: N" shows per-input breakdown.
8. No regression: Number type still shows Range and CSV tabs, not List or Single Value.
</verification>

<success_criteria>
- String List tab visible and functional with textarea entry
- Deduplication silently removes duplicates from both List and CSV string modes
- Iteration count tooltip shows per-input breakdown on hover
- Library loading restores string type information
- All numeric input behavior unchanged (zero regression)
- TypeScript compilation passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/03.4-multi-value-string-inputs/03.4-01-SUMMARY.md`
</output>
