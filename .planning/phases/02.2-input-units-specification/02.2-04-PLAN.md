---
phase: 02.2-input-units-specification
plan: 04
type: execute
wave: 2
depends_on: [02.2-01]
files_modified: [frontend/src/components/InputModal.tsx, frontend/src/services/api.ts]
autonomous: true

must_haves:
  truths:
    - "InputModal displays units selector with common engineering unit presets"
    - "User can select from presets or type custom units"
    - "User can leave units blank for worksheet default"
    - "InputConfig type exists in api.ts with units field"
    - "InputModal.onSave callback returns units along with values"
  artifacts:
    - path: "frontend/src/components/InputModal.tsx"
      provides: "UI for units selection in input configuration"
      contains: "UNIT_PRESETS"
      min_lines: 20
    - path: "frontend/src/services/api.ts"
      provides: "TypeScript types for InputConfig with units"
      contains: "export interface InputConfig"
      min_lines: 5
  key_links:
    - from: "InputModal.tsx"
      to: "api.ts"
      via: "import { InputConfig } from '../services/api'"
      pattern: "import.*InputConfig"
    - from: "InputModal.tsx"
      to: "parent component"
      via: "onSave: (config: InputConfig) => void callback"
      pattern: "onSave.*InputConfig"
---

<objective>
Add units selector UI to InputModal and define InputConfig TypeScript type.

Purpose: Provide users with a dropdown to select common engineering units or enter custom unit strings, and ensure units are passed to backend via InputConfig objects.
Output: InputModal with units selector and InputConfig type definition in api.ts.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02.2-input-units-specification/02.2-RESEARCH.md
@.planning/phases/02.2-input-units-specification/02.2-01-SUMMARY.md

@frontend/src/components/InputModal.tsx
@frontend/src/services/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add InputConfig type to api.ts</name>
  <files>frontend/src/services/api.ts</files>
  <action>
Add InputConfig interface after BatchRequest interface (around line 11):

```typescript
export interface InputConfig {
  alias: string;
  value: any;
  units?: string;  // Units specification (e.g., "in", "ft", "kip", or undefined for default)
}
```

This provides:
- Type-safe input configuration with optional units field
- Consistency with backend InputConfig dataclass
- TypeScript type checking for units throughout frontend

Why this location: api.ts already contains BatchRequest and other data types. InputConfig belongs here as a shared type used across components.
</action>
  <verify>
Verify that:
1. TypeScript compiles: `cd frontend && npm run type-check` (if available) or check for no type errors
2. InputConfig interface has correct fields (alias: string, value: any, units?: string)
3. No TypeScript errors in api.ts
</verify>
  <done>InputConfig interface added to api.ts with alias, value, and optional units field</done>
</task>

<task type="auto">
  <name>Task 2: Add units selector to InputModal.tsx</name>
  <files>frontend/src/components/InputModal.tsx</files>
  <action>
Update InputModal to include units selector:

1. Import InputConfig type (after line 5):
```typescript
import { InputConfig } from '../services/api';
```

2. Add UNIT_PRESETS constant after imports (after line 11):
```typescript
const UNIT_PRESETS = [
  { value: "", label: "Use Worksheet Units (Default)" },
  { value: "in", label: "in (inches)" },
  { value: "ft", label: "ft (feet)" },
  { value: "mm", label: "mm (millimeters)" },
  { value: "m", label: "m (meters)" },
  { value: "kip", label: "kip (kilopound force)" },
  { value: "lbf", label: "lbf (pound force)" },
  { value: "N", label: "N (newton)" },
  { value: "kN", label: "kN (kilonewton)" },
  { value: "Pa", label: "Pa (pascal)" },
  { value: "MPa", label: "MPa (megapascal)" },
  { value: "psi", label: "psi (pounds per square inch)" },
  { value: "ksf", label: "ksf (kip per square foot)" },
  { value: "kip/ft", label: "kip/ft (force per length)" },
  { value: "kip-in", label: "kip-in (moment)" },
  { value: "lb-ft", label: "lb-ft (pound-foot moment)" },
];
```

3. Update InputModalProps interface to handle InputConfig:
```typescript
interface InputModalProps {
  opened: boolean
  onClose: () => void
  alias: string
  onSave: (config: InputConfig) => void  // Changed from (values: any[]) => void
}
```

4. Add units state after csvData state (after line 25):
```typescript
  const [selectedUnits, setSelectedUnits] = useState<string | null>("");
```

5. Update handleSave to return InputConfig object (replace lines 38-48):
```typescript
  const handleSave = () => {
    const value: any = activeTab === 'range'
      ? generateRange(Number(start), Number(end), Number(step))
      : (selectedHeader && csvData.length > 0
        ? csvData.map(row => row[selectedHeader])
        : null);

    if (value !== null) {
      onSave({
        alias: alias,
        value: value,
        units: selectedUnits || undefined  // Convert "" to undefined
      });
    }
  }
```

6. Add units selector in modal content (after the Tabs component, before the buttons):
Insert after line 97 (after closing </Tabs> tag):
```typescript
        <Select
          label="Units"
          placeholder="Select units (optional)"
          data={UNIT_PRESETS}
          value={selectedUnits}
          onChange={setSelectedUnits}
          searchable
          creatable  // Allow custom units entry
          clearable  // Allow clearing selection (goes back to default "")
        />
```

Key changes:
- Add common engineering unit presets from RESEARCH.md
- Update onSave callback signature to return InputConfig instead of just values
- Add units state with default ""
- Add Mantine Select component with presets, searchable, creatable, and clearable props
- Pass units to parent component via onSave callback

Why this approach: Mantine Select with creatable prop allows users to type custom units. Clearable prop allows returning to "" (worksheet units default). Presets cover common engineering units while allowing flexibility for any unit string.

Note: Parent component (where InputModal is used) will need to handle InputConfig instead of raw values. This will be updated in parent component's batch configuration logic.
</action>
  <verify>
Verify that:
1. TypeScript compiles: Check for no type errors in InputModal.tsx
2. UNIT_PRESETS constant exists with correct structure
3. InputModal has units selector visible in UI
4. onSave callback returns InputConfig object with alias, value, and units fields
5. Select component has searchable, creatable, and clearable props
</verify>
  <done>InputModal displays units selector with presets and returns InputConfig object with units field</done>
</task>

</tasks>

<verification>
After completing this plan, verify:
- InputConfig interface exists in api.ts
- InputModal shows units selector dropdown
- User can select from presets, type custom units, or leave blank
- InputModal.onSave returns InputConfig object
- No TypeScript compilation errors
</verification>

<success_criteria>
1. InputConfig TypeScript interface defined with alias, value, units fields
2. UNIT_PRESETS constant has 16 common engineering units
3. InputModal displays units selector below tabs
4. Units selector supports preset selection, custom entry, and clearing
5. InputModal.onSave callback returns structured InputConfig object
</success_criteria>

<output>
After completion, create `.planning/phases/02.2-input-units-specification/02.2-04-SUMMARY.md`
</output>
